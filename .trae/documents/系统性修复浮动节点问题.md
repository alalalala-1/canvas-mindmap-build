## 发现的问题

### 1. 边变化检测重复（高优先级）
有两个边变化检测机制同时运行：
- `EdgeChangeDetector` 类（在 `FloatingNodeService` 中）
- `EdgeChangeDetection`（在 `CanvasEventManager.setupMutationObserver` 中）

这导致同一条边被检测两次，浮动节点连接边时需要连接两次。

### 2. 打开关闭 Canvas 后浮动节点没有红框（高优先级）
`initialize` 方法中的样式应用可能有问题，或者 `setupCanvasEventListeners` 没有被正确调用。

### 3. 代码重复和逻辑冲突（中优先级）
- `CanvasEventManager` 中有自己的边变化检测逻辑
- `FloatingNodeService` 中也有边变化检测逻辑
- 两者功能重复，导致冲突

## 修复计划

### 1. 移除 CanvasEventManager 中的边变化检测
- 删除 `setupMutationObserver` 中的 `startEdgeChangeDetection` 调用
- 保留 `FloatingNodeService` 中的 `EdgeChangeDetector` 作为唯一的检测机制

### 2. 修复 initialize 调用
- 确保 `setupCanvasEventListeners` 正确调用 `initialize`
- 添加调试日志确认 `reapplyAllFloatingStyles` 被调用

### 3. 清理重复代码
- 移除 `CanvasEventManager` 中的 `startEdgeChangeDetection` 方法
- 移除相关的辅助方法（`getEdgeIds`, `generateEdgeId`, `getNewEdgeIds`, `processNewEdges` 等）

## 修改文件

1. **canvas-event-manager.ts**
   - 移除 `setupMutationObserver` 中的 `startEdgeChangeDetection` 调用
   - 移除 `startEdgeChangeDetection` 方法
   - 移除相关的辅助方法

2. **canvas-manager.ts**
   - 已经修改了 `startEdgeChangeDetectionForFloatingNodes`

让我开始修复这些问题。