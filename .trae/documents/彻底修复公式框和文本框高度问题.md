## bloc问题分析

### 1. 公式检测问题

* 当前使用 `startsWith('$$') && endsWith('$$')` 检测

* 如果公式有换行或空格会检测失败

* **修复**：使用正则 `/^\$\$[\s\S]*\$\$$/` 检测

### 2. 文本框高度过大

* 需要进一步减小参数

* **修复**：

  * avgCharWidth: 9px → 10px

  * lineHeight: 22px → 20px

  * verticalPadding: 16px → 12px

  * minHeight: 60px → 50px

### 3. "未找到 Canvas 容器"日志问题

* `isObserverSetup` 标志没有正确工作

* 需要检查调用逻辑

* **修复**：在重试逻辑中添加更严格的检查

## 修改内容

### 1. 修复公式检测（adjustAllTextNodeHeights 方法）

```typescript
const isFormula = this.settings.enableFormulaDetection && 
    /^\$\$[\s\S]*\$\$$/.test(trimmedContent);
```

### 2. 减小文本框高度计算（calculateTextNodeHeight 方法）

* 所有参数进一步减小

### 3. 修复日志问题（setupMutationObserver 方法）

* 添加更

