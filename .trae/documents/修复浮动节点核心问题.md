## 发现的关键问题

### 1. 删除边时所有子节点都变红框（高优先级）
**原因**: `deleteEdge` 方法中直接标记 `childNodeId` 为浮动节点，但没有检查该节点是否还有其他入边。

**修复方案**:
- 在标记为浮动节点之前，检查节点是否还有其他入边
- 只有当节点没有其他入边时才标记为浮动节点

### 2. 关闭打开 Canvas 后浮动节点没加红框（高优先级）
**原因**: `setupCanvasEventListeners` 中调用 `initialize` 是同步的，没有使用 `await`，导致初始化未完成时样式就已经应用。

**修复方案**:
- 将 `setupCanvasEventListeners` 改为 async 方法
- 使用 await 等待 `initialize` 完成

### 3. 节点选中时错误清除浮动状态（高优先级）
**原因**: `node-select` 事件处理中检查 `hasIncomingEdge || hasOutgoingEdge`，但浮动节点可以有出边（子节点），只要没有入边就仍然是浮动节点。

**修复方案**:
- 只检查 `hasIncomingEdge`，有入边才清除浮动状态

### 4. handleNewEdge 只检查目标节点（中优先级）
**原因**: 只检查 `toNodeId` 是否是浮动节点，但源节点也可能是浮动节点。

**修复方案**:
- 同时检查 `fromNodeId` 和 `toNodeId`

## 修复计划

1. **修复 deleteEdge 方法** - 添加检查其他入边的逻辑
2. **修复 setupCanvasEventListeners 方法** - 改为 async 并使用 await
3. **修复 node-select 事件处理** - 只检查入边
4. **修复 handleNewEdge 方法** - 同时检查源节点和目标节点
5. **编译检查** - 确保所有修改正确编译

让我开始修复这些问题。