## 问题分析

从日志可以看到：
1. 常规 arrange 也不能正常工作，节点有重叠
2. 浮动节点的子节点和其他节点有重叠
3. 布局逻辑混乱

根本问题：
- 当前的布局算法试图同时处理正常节点和浮动节点，导致逻辑复杂
- 浮动节点作为"虚拟子节点"的概念引入了额外的复杂性
- 层级计算和位置计算没有正确分离

## 系统性解决方案

### 核心原则

1. **分离正常节点和浮动节点**
   - 正常节点：按树形结构布局
   - 浮动节点：保持原位，不参与正常布局

2. **浮动节点的子节点独立布局**
   - 浮动节点的子节点作为独立的"子树"
   - 在浮动节点的右侧布局
   - 垂直居中于浮动节点

3. **避免重叠**
   - 正常节点之间有良好的间距
   - 浮动节点的子树与正常节点之间也有良好的间距

### 布局步骤

1. **识别所有树结构**
   - 找到所有根节点（没有父节点的节点）
   - 每个根节点及其后代形成一棵树

2. **布局每棵树**
   - 计算子树高度
   - 从根节点开始，递归布局子节点
   - 子节点垂直居中于父节点

3. **处理浮动节点**
   - 浮动节点保持原位
   - 浮动节点的子节点在浮动节点右侧布局
   - 计算浮动节点子树的高度和位置

4. **处理多棵树**
   - 计算每棵树的总高度
   - 树与树之间有足够的垂直间距

### 关键改进

1. **简化层级计算**
   - 只考虑正常节点的层级
   - 浮动节点及其子节点不参与层级计算

2. **简化位置计算**
   - 正常节点：按层级计算 X 坐标
   - 浮动节点：保持原 X 坐标
   - 浮动节点的子节点：在浮动节点右侧计算 X 坐标

3. **避免重叠**
   - 正常节点树之间有足够的垂直间距
   - 浮动节点的子树与正常节点树之间也有足够的间距

## 实施计划

1. 完全重写 `arrangeLayout` 函数
2. 简化数据结构，移除 `virtualParentId`
3. 分离正常节点和浮动节点的布局逻辑
4. 确保子节点垂直居中于父节点
5. 确保节点之间没有重叠
6. 测试验证

请确认这个方案后，我将开始实施具体的代码修改。