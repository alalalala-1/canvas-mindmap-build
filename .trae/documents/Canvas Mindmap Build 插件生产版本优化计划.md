## 优化计划概述

基于对项目代码的全面分析，为发布生产版本（支持 Mac 和安卓平台），需要进行以下优化：

### 一、关键问题修复（高优先级）

#### 1. 错误处理完善
- **文件**: `canvas-manager.ts`, `edge-manager.ts`, `main.ts`
- **问题**: 缺少 try-catch，异步错误未处理，空值检查不足
- **修复**: 添加全面的错误边界和空值检查

#### 2. 内存泄漏修复
- **文件**: `canvas-manager.ts`
- **问题**: `clickDebounceMap` 无清理机制，事件监听器未完全清理
- **修复**: 添加定期清理和完整的 unload 清理逻辑

#### 3. 类型安全增强
- **文件**: `canvas-manager.ts`, `canvas/types.ts`
- **问题**: 多处使用 `any` 类型，缺少 Canvas/Node 类型定义
- **修复**: 定义完整的 TypeScript 接口，使用类型守卫

### 二、性能优化（中优先级）

#### 4. DOM 查询优化
- **文件**: `canvas-manager.ts`
- **问题**: 频繁的 `querySelectorAll` 调用
- **修复**: 实现 DOM 元素缓存机制

#### 5. 布局算法优化
- **文件**: `canvas/layout.ts`
- **问题**: 递归计算无记忆化，大数据量时性能差
- **修复**: 添加记忆化和分批处理

#### 6. 重复代码提取
- **文件**: `canvas-manager.ts`, `edge-manager.ts`
- **问题**: 获取 edges/nodes 逻辑重复
- **修复**: 创建 `CanvasDataExtractor` 工具类

### 三、移动端适配（针对安卓）

#### 7. 触摸事件支持
- **文件**: `canvas-manager.ts`
- **问题**: 只处理鼠标点击，无触摸事件
- **修复**: 添加 touchstart/touchend 处理

#### 8. 响应式设计完善
- **文件**: `styles.css`
- **问题**: 媒体查询不完整，缺少小屏手机适配
- **修复**: 添加 375px/414px/768px 断点，支持暗黑模式

#### 9. 性能自适应
- **文件**: `canvas-manager.ts`
- **问题**: 低端安卓设备可能卡顿
- **修复**: 检测设备性能，动态调整节流参数

### 四、代码质量提升

#### 10. 硬编码值提取
- **文件**: `canvas-manager.ts`
- **问题**: 多处硬编码时间/尺寸值
- **修复**: 提取到 `constants.ts` 或设置中

#### 11. 设置验证和迁移
- **文件**: `main.ts`, `settings/validator.ts`（新建）
- **问题**: 设置数据无验证，无版本迁移
- **修复**: 添加设置验证函数和迁移逻辑

### 五、发布准备

#### 12. 版本号同步
- **文件**: `package.json`, `manifest.json`
- **问题**: package.json 版本 1.0.0，manifest.json 版本 1.1.0
- **修复**: 统一版本号为 1.2.0

#### 13. 构建配置检查
- **文件**: `esbuild.config.mjs`
- **检查**: 确保生产构建优化（代码压缩、tree shaking）

#### 14. 文档完善
- **文件**: `README.md`
- **添加**: 安卓平台使用说明、性能建议

### 实施顺序建议

**阶段 1（必须）**: 1-3 错误处理和内存泄漏修复
**阶段 2（重要）**: 4-6 性能优化
**阶段 3（安卓适配）**: 7-9 移动端优化
**阶段 4（ polish ）**: 10-14 代码质量和发布准备

### 预期结果

- ✅ 在 Mac 和安卓平台稳定运行
- ✅ 支持触摸操作
- ✅ 低端安卓设备流畅使用
- ✅ 无内存泄漏，可长时间运行
- ✅ 完整的错误处理和用户反馈

请确认此计划后，我将开始实施具体的代码修改。